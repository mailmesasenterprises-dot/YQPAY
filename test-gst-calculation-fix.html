<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GST Calculation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .calculation {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: monospace;
        }
        .result {
            background: #dcfce7;
            border: 2px solid #22c55e;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .error {
            background: #fef2f2;
            border: 2px solid #ef4444;
            color: #dc2626;
        }
        .step {
            margin: 10px 0;
            padding: 8px;
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßÆ GST Calculation Analysis</h1>
        <p>Testing the GST calculation issue from the customer cart screenshot.</p>
        
        <h2>üìä Screenshot Values:</h2>
        <div class="calculation">
Product: Pop Corn - 150ML
Original Price: ‚Çπ200.00 (crossed out)
Discount: 5% OFF  
Current Price: ‚Çπ190.00
Quantity: 1

Cart Summary:
Subtotal: ‚Çπ200.00
Tax (GST) - Excluded: ‚Çπ10.00
Discount: -‚Çπ10.50
Total: ‚Çπ199.50
        </div>
        
        <h2>üîç Analysis:</h2>
        
        <h3>Current (Incorrect) Calculation:</h3>
        <div class="calculation error">
<strong>Issue:</strong> GST is calculated on original price, not discounted price

Step 1: Original Price = ‚Çπ200.00
Step 2: GST (5%) = ‚Çπ200.00 √ó 0.05 = ‚Çπ10.00
Step 3: Discount (5%) = (‚Çπ200.00 + ‚Çπ10.00) √ó 0.05 = ‚Çπ10.50
Step 4: Total = ‚Çπ200.00 + ‚Çπ10.00 - ‚Çπ10.50 = ‚Çπ199.50

<strong>Problem:</strong> Discount is applied to (original + GST) instead of original price
        </div>
        
        <h3>Correct Calculation (Fixed):</h3>
        <div class="calculation result">
<strong>Standard GST EXCLUDE Calculation:</strong>

Step 1: Original Price = ‚Çπ200.00
Step 2: Apply Discount (5%) = ‚Çπ200.00 √ó 0.05 = ‚Çπ10.00
Step 3: Discounted Price = ‚Çπ200.00 - ‚Çπ10.00 = ‚Çπ190.00
Step 4: Calculate GST (5%) on discounted price = ‚Çπ190.00 √ó 0.05 = ‚Çπ9.50
Step 5: Total = ‚Çπ190.00 + ‚Çπ9.50 = ‚Çπ199.50

<strong>Cart Display Should Show:</strong>
Subtotal: ‚Çπ190.00 (after discount)
Tax (GST) - Excluded: ‚Çπ9.50 (5% of discounted amount)
Discount: -‚Çπ10.00 (5% of original price)
Total: ‚Çπ199.50
        </div>
        
        <h2>üîß JavaScript Test:</h2>
        <button onclick="testCalculation()">üßÆ Test Fixed Calculation</button>
        <div id="testResult"></div>
        
        <h2>üìù Summary:</h2>
        <div class="step">
            <strong>Issue:</strong> GST was being calculated on original price, then discount applied to (original + GST)
        </div>
        <div class="step">
            <strong>Fix:</strong> Apply discount first, then calculate GST on discounted amount
        </div>
        <div class="step">
            <strong>Result:</strong> Correct GST calculation that matches business logic
        </div>
    </div>

    <script>
        function testCalculation() {
            const originalPrice = 200.00;
            const discountPercentage = 5;
            const taxRate = 5; // Assuming 5% GST based on ‚Çπ10 tax on ‚Çπ200
            const quantity = 1;
            const gstType = 'EXCLUDE';
            
            // Fixed calculation
            const discountAmount = (originalPrice * quantity) * (discountPercentage / 100);
            const discountedPrice = (originalPrice * quantity) - discountAmount;
            
            let subtotal, tax, total;
            
            if (gstType === 'EXCLUDE') {
                subtotal = discountedPrice;
                tax = discountedPrice * (taxRate / 100);
                total = discountedPrice + tax;
            }
            
            const result = `
                <div class="result">
                    <h3>üßÆ Calculation Result:</h3>
                    <strong>Original Price:</strong> ‚Çπ${originalPrice.toFixed(2)}<br>
                    <strong>Discount (${discountPercentage}%):</strong> -‚Çπ${discountAmount.toFixed(2)}<br>
                    <strong>Discounted Price:</strong> ‚Çπ${discountedPrice.toFixed(2)}<br>
                    <strong>GST (${taxRate}% on discounted):</strong> ‚Çπ${tax.toFixed(2)}<br>
                    <strong>Final Total:</strong> ‚Çπ${total.toFixed(2)}<br>
                    <br>
                    <strong>Cart Display:</strong><br>
                    Subtotal: ‚Çπ${subtotal.toFixed(2)}<br>
                    Tax (GST) - Excluded: ‚Çπ${tax.toFixed(2)}<br>
                    Discount: -‚Çπ${discountAmount.toFixed(2)}<br>
                    Total: ‚Çπ${total.toFixed(2)}
                </div>
            `;
            
            document.getElementById('testResult').innerHTML = result;
        }
    </script>
</body>
</html>