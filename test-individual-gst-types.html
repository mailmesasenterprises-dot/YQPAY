<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Individual Product GST Type Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: #fafafa;
        }
        .calculation {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .result {
            background: #dcfce7;
            border: 2px solid #22c55e;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .product {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 10px;
            margin: 8px 0;
        }
        button {
            background: #22c55e;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #16a34a;
        }
        button.test {
            background: #3b82f6;
        }
        button.test:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Individual Product GST Type Calculation Test</h1>
        <p>Testing GST calculations with different products having different GST types (INCLUDE vs EXCLUDE).</p>
        
        <div class="test-section">
            <h2>üõí Test Scenario: Mixed GST Types Cart</h2>
            
            <div class="product">
                <strong>Product 1: Popcorn</strong><br>
                Price: ‚Çπ200, GST: 5% EXCLUDE, Discount: 5%
            </div>
            
            <div class="product">
                <strong>Product 2: Cold Drink</strong><br>
                Price: ‚Çπ150, GST: 12% INCLUDE, Discount: 10%
            </div>
            
            <button class="test" onclick="testMixedGSTCalculation()">üßÆ Test Mixed GST Calculation</button>
            <div id="mixedTestResult"></div>
        </div>
        
        <div class="test-section">
            <h2>üìä Individual Product Calculations</h2>
            
            <h3>Product 1 (GST EXCLUDE):</h3>
            <div class="calculation">
Original Price: ‚Çπ200.00
Discount (5%): ‚Çπ200.00 √ó 0.05 = ‚Çπ10.00
Discounted Price: ‚Çπ200.00 - ‚Çπ10.00 = ‚Çπ190.00
GST (5% on discounted): ‚Çπ190.00 √ó 0.05 = ‚Çπ9.50
Total: ‚Çπ190.00 + ‚Çπ9.50 = ‚Çπ199.50
            </div>
            
            <h3>Product 2 (GST INCLUDE):</h3>
            <div class="calculation">
Original Price: ‚Çπ150.00 (includes GST)
Discount (10%): ‚Çπ150.00 √ó 0.10 = ‚Çπ15.00
Discounted Price: ‚Çπ150.00 - ‚Çπ15.00 = ‚Çπ135.00
Base Price: ‚Çπ135.00 √∑ 1.12 = ‚Çπ120.54
GST Amount: ‚Çπ135.00 - ‚Çπ120.54 = ‚Çπ14.46
Total: ‚Çπ135.00 (same as discounted since GST included)
            </div>
            
            <h3>Combined Cart Total:</h3>
            <div class="result">
                <strong>Expected Results:</strong><br>
                Subtotal: ‚Çπ190.00 + ‚Çπ120.54 = ‚Çπ310.54<br>
                Tax: ‚Çπ9.50 + ‚Çπ14.46 = ‚Çπ23.96<br>
                Discount: ‚Çπ10.00 + ‚Çπ15.00 = ‚Çπ25.00<br>
                Total: ‚Çπ199.50 + ‚Çπ135.00 = ‚Çπ334.50<br>
                <strong>GST Label:</strong> "Tax (GST) - Mixed"
            </div>
        </div>
        
        <div class="test-section">
            <h2>üîß Test Different Scenarios</h2>
            
            <button onclick="testAllExclude()">üì§ Test All GST EXCLUDE</button>
            <button onclick="testAllInclude()">üì• Test All GST INCLUDE</button>
            <button onclick="testSingleProduct()">üéØ Test Single Product</button>
            
            <div id="scenarioResults"></div>
        </div>
        
        <div class="test-section">
            <h2>‚úÖ Key Improvements</h2>
            <ul>
                <li>‚úÖ Each product uses its own <code>gstType</code> (INCLUDE/EXCLUDE)</li>
                <li>‚úÖ No more static defaults - dynamic based on product data</li>
                <li>‚úÖ Proper handling of mixed GST types in same cart</li>
                <li>‚úÖ Correct GST label display (Mixed/Included/Excluded)</li>
                <li>‚úÖ Debug logging to track individual product calculations</li>
                <li>‚úÖ Accurate discount application before GST calculation</li>
            </ul>
        </div>
    </div>

    <script>
        function testMixedGSTCalculation() {
            const products = [
                {
                    name: "Popcorn",
                    price: 200,
                    gstType: "EXCLUDE",
                    taxRate: 5,
                    discountPercentage: 5,
                    quantity: 1
                },
                {
                    name: "Cold Drink", 
                    price: 150,
                    gstType: "INCLUDE",
                    taxRate: 12,
                    discountPercentage: 10,
                    quantity: 1
                }
            ];
            
            let totalSubtotal = 0;
            let totalTax = 0;
            let totalDiscount = 0;
            let totalAmount = 0;
            let gstTypes = [];
            let details = [];
            
            products.forEach(item => {
                const originalPrice = item.price * item.quantity;
                const discountAmount = originalPrice * (item.discountPercentage / 100);
                const discountedPrice = originalPrice - discountAmount;
                
                let itemSubtotal, itemTax, itemTotal;
                
                if (item.gstType === 'INCLUDE') {
                    itemSubtotal = discountedPrice / (1 + (item.taxRate / 100));
                    itemTax = discountedPrice - itemSubtotal;
                    itemTotal = discountedPrice;
                } else {
                    itemSubtotal = discountedPrice;
                    itemTax = discountedPrice * (item.taxRate / 100);
                    itemTotal = discountedPrice + itemTax;
                }
                
                totalSubtotal += itemSubtotal;
                totalTax += itemTax;
                totalDiscount += discountAmount;
                totalAmount += itemTotal;
                
                if (!gstTypes.includes(item.gstType)) {
                    gstTypes.push(item.gstType);
                }
                
                details.push(`
                    <div class="calculation">
                        <strong>${item.name} (${item.gstType}):</strong><br>
                        Original: ‚Çπ${originalPrice.toFixed(2)}<br>
                        Discount: -‚Çπ${discountAmount.toFixed(2)}<br>
                        Discounted: ‚Çπ${discountedPrice.toFixed(2)}<br>
                        Subtotal: ‚Çπ${itemSubtotal.toFixed(2)}<br>
                        Tax: ‚Çπ${itemTax.toFixed(2)}<br>
                        Item Total: ‚Çπ${itemTotal.toFixed(2)}
                    </div>
                `);
            });
            
            const gstLabel = gstTypes.length > 1 
                ? "Tax (GST) - Mixed"
                : gstTypes.includes('INCLUDE') 
                    ? "Tax (GST) - Included"
                    : "Tax (GST) - Excluded";
            
            const result = `
                <div class="result">
                    <h3>üßÆ Mixed GST Calculation Result:</h3>
                    ${details.join('')}
                    <div class="result">
                        <strong>Cart Summary:</strong><br>
                        Subtotal: ‚Çπ${totalSubtotal.toFixed(2)}<br>
                        ${gstLabel}: ‚Çπ${totalTax.toFixed(2)}<br>
                        Discount: -‚Çπ${totalDiscount.toFixed(2)}<br>
                        <strong>Total: ‚Çπ${totalAmount.toFixed(2)}</strong>
                    </div>
                </div>
            `;
            
            document.getElementById('mixedTestResult').innerHTML = result;
        }
        
        function testAllExclude() {
            const result = `
                <div class="result">
                    <h3>üì§ All GST EXCLUDE Test:</h3>
                    <strong>Expected Label:</strong> "Tax (GST) - Excluded"<br>
                    <strong>Calculation:</strong> Discount applied first, then GST on discounted amount
                </div>
            `;
            document.getElementById('scenarioResults').innerHTML = result;
        }
        
        function testAllInclude() {
            const result = `
                <div class="result">
                    <h3>üì• All GST INCLUDE Test:</h3>
                    <strong>Expected Label:</strong> "Tax (GST) - Included"<br>
                    <strong>Calculation:</strong> GST extracted from discounted inclusive price
                </div>
            `;
            document.getElementById('scenarioResults').innerHTML = result;
        }
        
        function testSingleProduct() {
            const result = `
                <div class="result">
                    <h3>üéØ Single Product Test:</h3>
                    <strong>Behavior:</strong> Uses individual product's GST type<br>
                    <strong>Label:</strong> Shows actual GST type (INCLUDE/EXCLUDE)
                </div>
            `;
            document.getElementById('scenarioResults').innerHTML = result;
        }
    </script>
</body>
</html>